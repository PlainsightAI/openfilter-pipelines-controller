---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.19.0
  name: pipelineruns.filter.plainsight.ai
spec:
  group: filter.plainsight.ai
  names:
    kind: PipelineRun
    listKind: PipelineRunList
    plural: pipelineruns
    singular: pipelinerun
  scope: Namespaced
  versions:
  - name: v1alpha1
    schema:
      openAPIV3Schema:
        description: PipelineRun is the Schema for the pipelineruns API
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: spec defines the desired state of PipelineRun
            properties:
              execution:
                description: execution defines how the pipeline should be executed
                properties:
                  maxAttempts:
                    default: 3
                    description: maxAttempts defines the maximum number of retry attempts
                      per file
                    format: int32
                    minimum: 1
                    type: integer
                  parallelism:
                    default: 10
                    description: parallelism defines the maximum number of parallel
                      executions (max concurrent pods)
                    format: int32
                    minimum: 1
                    type: integer
                  pendingTimeout:
                    default: 15m
                    description: |-
                      pendingTimeout defines the time after which pending messages are reclaimed
                      Supports Kubernetes duration format (e.g., "15m", "1h", "30s")
                    type: string
                type: object
              pipelineRef:
                description: pipelineRef references the Pipeline resource to execute
                properties:
                  name:
                    description: name is the name of the Pipeline resource
                    type: string
                  namespace:
                    description: |-
                      namespace is the namespace of the Pipeline resource
                      If not specified, the PipelineRun's namespace is used
                    type: string
                required:
                - name
                type: object
              source:
                description: |-
                  source defines the input source for the pipeline run
                  For Batch mode: source.bucket is required, source.rtsp is forbidden
                  For Stream mode: source.rtsp is required, source.bucket is forbidden
                properties:
                  bucket:
                    description: |-
                      bucket defines an S3-compatible object storage source
                      Required when mode is Batch, forbidden when mode is Stream
                    properties:
                      credentialsSecret:
                        description: |-
                          credentialsSecret references a Secret containing access credentials
                          Expected keys: "accessKeyId" and "secretAccessKey"
                        properties:
                          name:
                            description: name is the name of the secret
                            type: string
                          namespace:
                            description: |-
                              namespace is the namespace of the secret
                              If empty, uses the same namespace as the Pipeline resource
                            type: string
                        required:
                        - name
                        type: object
                      endpoint:
                        description: |-
                          endpoint is the S3-compatible endpoint URL (required for non-AWS S3)
                          Examples:
                            - MinIO: "http://minio.example.com:9000"
                            - GCS: "https://storage.googleapis.com"
                            - Custom S3: "https://s3.custom.example.com"
                          Leave empty for AWS S3 (will use default AWS endpoints)
                        type: string
                      insecureSkipTLSVerify:
                        default: false
                        description: insecureSkipTLSVerify skips TLS certificate verification
                          (useful for dev/test)
                        type: boolean
                      name:
                        description: name is the name of the S3-compatible bucket
                        minLength: 1
                        type: string
                      prefix:
                        description: prefix is an optional path prefix within the
                          bucket (e.g., "input-data/")
                        type: string
                      region:
                        description: |-
                          region is the bucket region (e.g., "us-east-1")
                          Required for AWS S3, optional for other providers
                        type: string
                      usePathStyle:
                        default: false
                        description: |-
                          usePathStyle forces path-style addressing (endpoint.com/bucket vs bucket.endpoint.com)
                          Required for MinIO and some S3-compatible services
                        type: boolean
                    required:
                    - name
                    type: object
                  rtsp:
                    description: |-
                      rtsp defines an RTSP stream source
                      Required when mode is Stream, forbidden when mode is Batch
                    properties:
                      credentialsSecret:
                        description: |-
                          credentialsSecret references a Secret containing RTSP credentials
                          Expected keys: "username" and "password"
                        properties:
                          name:
                            description: name is the name of the secret
                            type: string
                          namespace:
                            description: |-
                              namespace is the namespace of the secret
                              If empty, uses the same namespace as the Pipeline resource
                            type: string
                        required:
                        - name
                        type: object
                      host:
                        description: host is the RTSP server hostname or IP address
                        minLength: 1
                        type: string
                      idleTimeout:
                        description: |-
                          idleTimeout defines the duration after which a continuously unready stream
                          will cause the PipelineRun to complete and the Deployment to be deleted.
                          If not set, the stream will run indefinitely.
                        type: string
                      path:
                        description: path is the RTSP stream path (e.g., "/stream1",
                          "/live/camera1")
                        type: string
                      port:
                        default: 554
                        description: port is the RTSP server port
                        format: int32
                        maximum: 65535
                        minimum: 1
                        type: integer
                    required:
                    - host
                    type: object
                type: object
            required:
            - pipelineRef
            - source
            type: object
          status:
            description: status defines the observed state of PipelineRun
            properties:
              completionTime:
                description: completionTime is when the pipeline run completed
                format: date-time
                type: string
              conditions:
                description: |-
                  conditions represent the current state of the PipelineRun resource.
                  Each condition has a unique type and reflects the status of a specific aspect of the resource.

                  Standard condition types include:
                  - "Available": the resource is fully functional
                  - "Progressing": the resource is being created or updated
                  - "Degraded": the resource failed to reach or maintain its desired state

                  The status of each condition is one of True, False, or Unknown.
                items:
                  description: Condition contains details for one aspect of the current
                    state of this API Resource.
                  properties:
                    lastTransitionTime:
                      description: |-
                        lastTransitionTime is the last time the condition transitioned from one status to another.
                        This should be when the underlying condition changed.  If that is not known, then using the time when the API field changed is acceptable.
                      format: date-time
                      type: string
                    message:
                      description: |-
                        message is a human readable message indicating details about the transition.
                        This may be an empty string.
                      maxLength: 32768
                      type: string
                    observedGeneration:
                      description: |-
                        observedGeneration represents the .metadata.generation that the condition was set based upon.
                        For instance, if .metadata.generation is currently 12, but the .status.conditions[x].observedGeneration is 9, the condition is out of date
                        with respect to the current state of the instance.
                      format: int64
                      minimum: 0
                      type: integer
                    reason:
                      description: |-
                        reason contains a programmatic identifier indicating the reason for the condition's last transition.
                        Producers of specific condition types may define expected values and meanings for this field,
                        and whether the values are considered a guaranteed API.
                        The value should be a CamelCase string.
                        This field may not be empty.
                      maxLength: 1024
                      minLength: 1
                      pattern: ^[A-Za-z]([A-Za-z0-9_,:]*[A-Za-z0-9_])?$
                      type: string
                    status:
                      description: status of the condition, one of True, False, Unknown.
                      enum:
                      - "True"
                      - "False"
                      - Unknown
                      type: string
                    type:
                      description: type of condition in CamelCase or in foo.example.com/CamelCase.
                      maxLength: 316
                      pattern: ^([a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*/)?(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])$
                      type: string
                  required:
                  - lastTransitionTime
                  - message
                  - reason
                  - status
                  - type
                  type: object
                type: array
                x-kubernetes-list-map-keys:
                - type
                x-kubernetes-list-type: map
              counts:
                description: counts tracks the number of files in each state (Batch
                  mode only)
                properties:
                  failed:
                    description: failed is the number of files that failed processing
                    format: int64
                    type: integer
                  queued:
                    description: queued is the number of files waiting to be processed
                    format: int64
                    type: integer
                  running:
                    description: running is the number of files currently being processed
                    format: int64
                    type: integer
                  succeeded:
                    description: succeeded is the number of files successfully processed
                    format: int64
                    type: integer
                  totalFiles:
                    description: totalFiles is the total number of files to process
                    format: int64
                    type: integer
                type: object
              jobName:
                description: jobName is the name of the Kubernetes Job created for
                  this run (Batch mode only)
                type: string
              startTime:
                description: startTime is when the pipeline run was started
                format: date-time
                type: string
              streaming:
                description: streaming provides observability into streaming pipeline
                  runs (Stream mode only)
                properties:
                  availableReplicas:
                    description: availableReplicas is the number of available replicas
                      in the streaming deployment
                    format: int32
                    type: integer
                  containerRestarts:
                    description: containerRestarts is the aggregate count of container
                      restarts across all pods
                    format: int32
                    type: integer
                  deploymentName:
                    description: deploymentName is the name of the Kubernetes Deployment
                      created for this streaming run
                    type: string
                  lastFrameAt:
                    description: lastFrameAt is the timestamp of the last processed
                      frame (best-effort)
                    format: date-time
                    type: string
                  lastReadyTime:
                    description: lastReadyTime is the last time the deployment became
                      ready
                    format: date-time
                    type: string
                  readyReplicas:
                    description: readyReplicas is the number of ready replicas in
                      the streaming deployment
                    format: int32
                    type: integer
                  updatedReplicas:
                    description: updatedReplicas is the number of updated replicas
                      in the streaming deployment
                    format: int32
                    type: integer
                type: object
            type: object
        required:
        - spec
        type: object
    served: true
    storage: true
    subresources:
      status: {}
